# yaml-language-server: $schema=https://raw.githubusercontent.com/quintush/helm-unittest/master/schema/helm-testsuite.json
suite: volume-provisioner rootless test
values:
  - ../values.yaml
templates:
  - templates/volume-provisioner/deployment.yaml
release:
  name: cf-runtime
  namespace: codefresh
  revision: 1
  upgrade: true
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: Test volume-provisioner with IS_ROOTLESS env var
    template: templates/volume-provisioner/deployment.yaml
    set:
      runtime:
        rootless: true
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: IS_ROOTLESS
            value: "true"

  - it: Test volume-provisioner without IS_ROOTLESS env var
    template: templates/volume-provisioner/deployment.yaml
    set:
      runtime:
        rootless: false
    asserts:
      - notContains:
          path: spec.template.spec.containers[0].env
          content:
            name: IS_ROOTLESS
            value: "true"
